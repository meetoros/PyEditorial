version: "3.6"

services:
 
 pyeditorial:
    build: .
    volumes:
       - .:/app
       - static_volume:/app/static
       - media_volume:/app/media
    networks:
       - nginx_network
       - database_network
    depends_on:
       - database
    
 nginx:
    image: nginx:1.18.0
    ports:
       - 8000:443
    #command: bash -c "openssl req -x509 -nodes -subj '/C=TR' -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt"
    volumes:
       - ./config/nginx/conf.d:/etc/nginx/conf.d
       - static_volume:/app/static
       - media_volume:/app/media
    depends_on:
       - pyeditorial
    networks:
       - nginx_network
 
 database:
    image: postgres:10
    ports:
       - 5432:5432
    env_file:
       - config/db/database_env
    networks:
       - database_network
    volumes:
       - database_volume:/var/lib/postgresql/data
  
networks:
   nginx_network:
      driver: bridge
   database_network:
      driver: bridge

volumes:
   database_volume:
   static_volume:
   media_volume:
